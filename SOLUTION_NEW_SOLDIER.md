# פתרון: חייל חדש לא יכול להתחבר

## הבעיה

כשמוסיפים חייל חדש, הוא נוצר בלי סיסמה. זה תקין - החייל צריך להגדיר סיסמה בפעם הראשונה.

## הפתרון המיידי

החייל החדש צריך להתחבר דרך הממשק ולהגיע למסך הגדרת סיסמה.

### איך זה אמור לעבוד:

1. **החייל מזין מספר אישי** בלבד
2. **המערכת מזהה שאין סיסמה**
3. **מופיע מסך להגדרת סיסמה**
4. **החייל מגדיר סיסמה**
5. **החייל נכנס למערכת**

## בדיקה מהירה

### בדוק אם החייל קיים במסד הנתונים:

```powershell
# Test login for new soldier
curl -X POST http://localhost:3001/api/auth/login `
  -H "Content-Type: application/json" `
  -d '{\"personalId\":\"המספר_האישי_של_החייל\"}'
```

אם החייל קיים, תראה:
```json
{
  "needsPassword": true,
  "personalId": "...",
  "userId": "..."
}
```

### הגדר סיסמה דרך API:

```powershell
curl -X POST http://localhost:3001/api/auth/set-password `
  -H "Content-Type: application/json" `
  -d '{\"personalId\":\"המספר_האישי\",\"password\":\"Password123!\"}'
```

## בעיה ידועה

הממשק עדיין משתמש בגישה הישנה (localStorage) ולא ב-API. זה אומר שהוא מחפש סיסמות בנתונים המקומיים ולא במסד הנתונים.

## פתרון זמני

עד שהממשק יתעדכן, אתה יכול:

1. **השתמש ב-Prisma Studio** להגדיר סיסמה ישירות:
   ```powershell
   cd server
   npm run db:studio
   ```
   - פתח את טבלת `Soldier`
   - מצא את החייל
   - עדכן את השדה `passwordHash` (צריך hash של הסיסמה)

2. **או השתמש ב-API ישירות** כמו שמוצג למעלה

## פתרון קבוע

צריך לעדכן את `App.tsx` כך שישתמש ב-API כש-`USE_API=true`. זה יאפשר:
- בדיקה נכונה אם חייל צריך להגדיר סיסמה
- הגדרת סיסמה דרך API
- התחברות דרך API

האם תרצה שאעדכן את הקוד עכשיו?

